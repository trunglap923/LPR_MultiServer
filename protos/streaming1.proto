syntax = "proto3";

package streaming;

// ğŸ“Œ Dá»‹ch vá»¥ nháº­n diá»‡n xe tá»« video stream
service VehicleDetectionService {
  rpc DetectVehicles(stream Frame) returns (stream VehicleDetection) {}
}

// ğŸ“Œ Dá»‹ch vá»¥ tracking xe (Bá»• sung Frame Ä‘á»ƒ DeepSORT hoáº¡t Ä‘á»™ng tá»‘t)
service TrackingService {
  rpc TrackObjects(stream TrackingRequest) returns (stream TrackingResult) {}
}

// ğŸ“Œ Dá»‹ch vá»¥ nháº­n diá»‡n biá»ƒn sá»‘
service PlateDetectionService {
  rpc DetectPlates(stream Frame) returns (stream PlateDetection) {}
}

// ğŸ“Œ Dá»‹ch vá»¥ OCR Ä‘á»ƒ Ä‘á»c biá»ƒn sá»‘
service OCRService {
  rpc RecognizePlate(stream CroppedPlate) returns (stream OCRResult) {}
}

// ğŸ“Œ Server táº­p há»£p káº¿t quáº£ vÃ  gá»­i Ä‘áº¿n Client
service ResultService {
  rpc AggregateResults(stream TrackingResult) returns (stream FinalResult) {}
}

// ğŸ–¼ï¸ Frame gá»‘c tá»« camera
message Frame {
  int64 frame_id = 1;
  int64 timestamp = 2;
  bytes image_data = 3;
}

// ğŸš— Káº¿t quáº£ nháº­n diá»‡n xe
message VehicleDetection {
  int64 frame_id = 1;
  repeated DetectedObject vehicles = 2;
}

// ğŸ“Œ Gá»­i cáº£ frame + bounding box Ä‘áº¿n Tracking Server
message TrackingRequest {
  int64 frame_id = 1;
  bytes image_data = 2; // ThÃªm áº£nh frame Ä‘á»ƒ DeepSORT sá»­ dá»¥ng
  repeated DetectedObject vehicles = 3;
}

// ğŸ¯ Káº¿t quáº£ tracking xe vÃ  biá»ƒn sá»‘
message TrackingResult {
  int64 frame_id = 1;
  repeated TrackedObject tracked_vehicles = 2;
}

message DetectedObject {
  int32 tracking_id = 1;
  BoundingBox bbox = 2;
  float confidence = 3;
}

// ğŸ“¦ Bounding box (dÃ¹ng chung cho táº¥t cáº£ service)
message BoundingBox {
  int32 x1 = 1;
  int32 y1 = 2;
  int32 x2 = 3;
  int32 y2 = 4;
}
